# CodeAgent

![downloads](https://img.shields.io/github/downloads/debamitro/one-shot-cli-agent/total)

> Note:
> This project was entirely generated by a [coding agent](https://sylph.ai)

A command-line interactive coding agent built in Rust with support for OpenAI and Anthropic LLMs.

## Features

- **Multi-Provider Support**: Works with both OpenAI (GPT-4o) and Anthropic (Claude) APIs
- **Custom LLM URL Support**: Can handle any LLM URL as long as it is compatible with the OpenAI or Anthropic API 
- **Interactive REPL**: Command-line interface for natural conversation with the AI
- **Tool System**: Built-in tools for file operations, code search, web search and command execution
- **Session Management**: Persistent conversation history with save/resume/export capability
- **Streaming Responses**: Real-time display of AI responses as they're generated

## Tools

### File Search Tool
- **glob**: Find files by pattern (e.g., `**/*.rs`)
- **grep**: Search file contents using ripgrep

### Edit File Tool
- **create_file**: Create new files
- **replace_by_string**: Replace unique text in files
- **replace_by_lines**: Replace line ranges in files
- **read_file**: Read file contents with optional line ranges

### Bash Tool
- Execute shell commands in the working directory

### Web Search Tool
- Uses DuckDuckGo by default, can use Serper API if the SERPER_API_KEY is set

## Installation

### Download pre-built releases

This is the easiest method. Just unzip and run from the command-line.

- [Windows](https://github.com/debamitro/one-shot-cli-agent/releases/download/v0.5/codeagent_0.5_win.zip)
- [MacOS (Apple Silicon)](https://github.com/debamitro/one-shot-cli-agent/releases/download/v0.5/codeagent_0.5_aarch64-apple-darwin.zip)
- [MacOS (Intel)](https://github.com/debamitro/one-shot-cli-agent/releases/download/v0.5/codeagent_0.5_x86_64-apple-darwin.zip)
- [Linux](https://github.com/debamitro/one-shot-cli-agent/releases/download/v0.5/codeagent_0.5_linux.zip)

### Build from Source

You need to have a Rust toolchain installed

```bash
cargo build --release
```

The binary will be in `target/release/codeagent`.

## Usage

### Basic Usage

```bash
# With OpenAI
codeagent --provider openai --api-key sk-... --directory /path/to/project

# With Anthropic
codeagent --provider anthropic --api-key sk-ant-... --directory /path/to/project

# Using environment variables
export OPENAI_API_KEY=sk-...
codeagent --provider openai

export ANTHROPIC_API_KEY=sk-ant-...
codeagent --provider anthropic
```

### Command-Line Options

```
Options:
  -p, --provider <PROVIDER>              Provider to use: openai or anthropic
  -a, --api-key <API_KEY>                API key (or set OPENAI_API_KEY/ANTHROPIC_API_KEY env var)
  -m, --model <MODEL>                    Model to use (optional, uses provider default)
  -d, --directory <DIRECTORY>            Working directory [default: .]
  -s, --session <SESSION>                Session ID to resume
      --openai-base-url <URL>            OpenAI base URL (optional, overrides default)
      --anthropic-base-url <URL>         Anthropic base URL (optional, overrides default)
      --system-prompt <TEXT>             System prompt override (direct text)
      --system-prompt-file <FILE>        System prompt override (read from file)
  -h, --help                             Print help
```

### Interactive Commands

Once in the REPL:

- Type your questions/requests naturally
- Type `save` to save the current session
- Type `exit` to quit (automatically saves)

## Examples

### Create a new file
```
You: create a hello world program in main.rs
```

### Search code
```
You: find all TODO comments in Rust files
```

### Execute commands
```
You: run cargo test
```

### Edit files
```
You: replace the println! statement in main.rs with a proper greeting function
```

## Session Storage

Sessions are stored in `~/.codeagent/sessions/` as JSON files. Each session contains:
- Conversation history
- Tool calls and results
- Metadata (title, timestamps, message count)

## Architecture

```
codeagent/
├── src/
│   ├── main.rs              # CLI entry point and REPL
│   ├── provider/            # LLM provider implementations
│   │   ├── mod.rs           # Provider trait
│   │   ├── openai.rs        # OpenAI integration
│   │   └── anthropic.rs     # Anthropic integration
│   ├── session/             # Session management
│   │   └── mod.rs           # Session storage and history
│   └── tools/               # Tool implementations
│       ├── mod.rs           # Tool registry
│       ├── file_search.rs   # File search (glob/grep)
│       ├── edit_file.rs     # File editing operations
│       ├── bash.rs          # Command execution
│       ├── web_search.rs    # Serper API web search
│       ├── web_search_ddg.rs # DuckDuckGo web search
│       └── url_fetch.rs     # URL content fetching
└── Cargo.toml
```

## Development

### Run in development mode

```bash
cargo run -- --provider openai --api-key sk-...
```

### Run tests

```bash
cargo test
```
